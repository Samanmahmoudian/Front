<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerJS Video Call</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <style>
        video {
            width: 45%;
            margin: 2%;
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <h1>PeerJS Video Call</h1>
    <input type="text" id="peerId" placeholder="Enter Peer ID" />
    <button id="callButton">Call</button>
    <button id="hangupButton" disabled>Hang Up</button>
    <div>
        <video id="localVideo" autoplay muted></video>
        <video id="remoteVideo" autoplay></video>
    </div>

    <script>
        const peer = new Peer({
            host: 'video-call-uylq.onrender.com',
            port:443,
            secure: true // Use HTTPS

        });

        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const callButton = document.getElementById('callButton');
        const hangupButton = document.getElementById('hangupButton');
        let currentCall;

        // Get access to the user's webcam
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then(stream => {
                localVideo.srcObject = stream;

                // Listen for incoming calls
                peer.on('call', call => {
                    call.answer(stream); // Answer the call with the local stream
                    call.on('stream', remoteStream => {
                        remoteVideo.srcObject = remoteStream; // Show the remote video stream
                    });
                    currentCall = call;
                });
            })
            .catch(err => {
                console.error('Failed to get local stream', err);
            });

        // Call another peer
        callButton.onclick = () => {
            const peerId = document.getElementById('peerId').value;
            if (peerId) {
                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                    .then(stream => {
                        const call = peer.call(peerId, stream);
                        call.on('stream', remoteStream => {
                            remoteVideo.srcObject = remoteStream; // Show the remote video stream
                        });
                        currentCall = call;
                    })
                    .catch(err => {
                        console.error('Failed to get local stream', err);
                    });
            } else {
                alert('Please enter a Peer ID to call.');
            }
        };

        // Hang up the call
        hangupButton.onclick = () => {
            if (currentCall) {
                currentCall.close();
                currentCall = null;
                remoteVideo.srcObject = null; // Clear the remote video
            }
        };

        // Display the peer ID
        peer.on('open', id => {
            document.getElementById('peerId').value = id; // Show the Peer ID in the input field
        });
    </script>
</body>
</html>